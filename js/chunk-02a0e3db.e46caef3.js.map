{"version":3,"sources":["webpack:///./src/views/book/TheView.vue","webpack:///./src/views/book/TheView.vue?5bad","webpack:///./src/views/book/TheView.vue?01a4"],"names":["class","id","$attrs","ref","handleScroll","book","text","editMode","annotation","value","progress","max","scrollByClick","editor-node","editorNode","saveEditor","activeImage","showSlide","src","apiUrl","name","components","EditorModal","props","data","genres","bookmark","progressLoad","windowScroll","timer","activeImageIndex","activeMedia","type","url","initialText","methods","this","$route","params","result","$get","prepareUrlForMedia","document","title","scrollToBookmark","console","log","$nextTick","$refs","scrollTo","$emit","$router","push","e","w","getElementById","clientWidth","o","offsetX","x","y","windowHeights","target","$modal","show","innerHTML","$patch","$toast","success","editor","Math","round","scrollTop","scrollHeight","clientHeight","regexp","RegExp","replace","toggleSide","media","querySelectorAll","elem","classList","add","images","getElementsByClassName","image","addEventListener","openImage","img","index","files","length","getSrcImgUrl","formData","computed","watch","loadBook","updateScrollProgress","moveMedia","listenClickByImg","render"],"mappings":"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","file":"js/chunk-02a0e3db.e46caef3.js","sourcesContent":["<template>\r\n  <div class=\"book-container\" v-bind=\"$attrs\">\r\n    <div class=\"book\" ref=\"book\" @scroll.passive=\"handleScroll\" id=\"book\">\r\n      <div class=\"text\" ref=\"text\" v-html=\"book.text\" @mouseup.ctrl=\"editMode\"></div>\r\n    </div>\r\n  </div>\r\n  <footer class=\"footer\" v-if=\"book.annotation !== 'media'\">\r\n    <progress class=\"progress\" :value=\"progress\" max=\"100\" id=\"progressbar\" @click=\"scrollByClick\"/>\r\n    <div class=\"progress-value\">{{ progress }}</div>\r\n  </footer>\r\n  <modal ref=\"editor\">\r\n    <editor-modal :editor-node=\"editorNode\" @save-editor=\"saveEditor\"/>\r\n  </modal>\r\n  <div id=\"image-modal\" class=\"image-modal\" v-if=\"activeImage\">\r\n    <span class=\"close\" @click=\"activeImage = null\">&times;</span>\r\n    <aside class=\"picture-action-panel\">\r\n      <button class=\"picture-arrow-btn\" @click=\"showSlide('first')\">1</button>\r\n      <button class=\"picture-arrow-btn\" @click=\"showSlide('prev')\">Back</button>\r\n    </aside>\r\n    <img class=\"modal-content\" id=\"img01\" :src=\"activeImage\">\r\n    <aside class=\"picture-action-panel\">\r\n      <button class=\"picture-arrow-btn\" @click=\"showSlide('last')\">e</button>\r\n      <button class=\"picture-arrow-btn\" @click=\"showSlide('next')\">Forward</button>\r\n    </aside>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {defineAsyncComponent} from \"vue\";\r\nconst apiUrl = process.env.VUE_APP_API_URL\r\n\r\nexport default {\r\n  name: \"Book\",\r\n  components: {\r\n    EditorModal: defineAsyncComponent(() => import('@/components/EditorModal.vue')),\r\n  },\r\n  props: {},\r\n\r\n  data: () => ({\r\n    book: {annotation: null, text: null, genres: [], bookmark: null},\r\n    progress: 0,\r\n    progressLoad: 0,\r\n    windowScroll: 0,\r\n    timer: null,\r\n    activeImage: null,\r\n    activeImageIndex: 0,\r\n    activeMedia: {type: null, url: null},\r\n    editorNode: {},\r\n    initialText: ''\r\n  }),\r\n  methods: {\r\n    async loadBook() {\r\n      const url = `/book/view?id=${this.$route.params.id}`;\r\n      const result = await this.$get(url)\r\n      if (result) {\r\n        this.book = await this.prepareUrlForMedia(result)\r\n        document.title = `Book: ${result.name}`;\r\n\r\n        this.scrollToBookmark()\r\n      } else {\r\n        console.log({'result': result})\r\n      }\r\n     },\r\n    async scrollToBookmark() {\r\n      if (this.book.bookmark) {\r\n        await this.$nextTick()\r\n        this.$refs.book.scrollTo(0, this.book.bookmark)\r\n      }\r\n    },\r\n    async relocateToMedia(book) {\r\n      await this.$emit('loaded-book', book)\r\n      await this.$router.push({name: 'book-media', params: {id: book.id}})\r\n    },\r\n    scrollByClick(e) {\r\n      let w = document.getElementById(\"progressbar\").clientWidth;\r\n      let o = e.offsetX;\r\n      let x = (100 * o) / w;\r\n      document.getElementById(\"progressbar\").value = x;\r\n      let y = (this.windowHeights * x) / 100;\r\n      document.getElementById('book').scrollTo(0, y);\r\n\r\n    },\r\n    editMode(e) {\r\n      this.editorNode = e.target\r\n      this.$modal.show('editor', this)\r\n    },\r\n    async saveEditor() {\r\n      this.book.text = this.$refs.text.innerHTML\r\n      const url = `/book/update?id=${this.$route.params.id}`\r\n      const result = await this.$patch(url, {text: this.book.text})\r\n      if (result) {\r\n        this.$toast.success('Успешно сохранено')\r\n      } else {\r\n        console.log({editor: result})\r\n      }\r\n    },\r\n    handleScroll(e) {\r\n      this.progress = Math.round((e.target.scrollTop * 100) / (e.target.scrollHeight - e.target.clientHeight))\r\n      this.windowScroll = e.target.scrollTop\r\n\r\n    },\r\n    prepareUrlForMedia(book) {\r\n      if(book.text) {\r\n        const regexp = new RegExp(\"APIURL\", \"g\");\r\n        book.text = book.text.replace(regexp, process.env.VUE_APP_API_URL)\r\n        return book\r\n      }\r\n      return book\r\n\r\n    },\r\n    moveMedia() {\r\n      let toggleSide = true\r\n      let media = document.querySelectorAll('.media')\r\n\r\n      for (const elem of media) {\r\n        elem.classList.add(toggleSide ? 'media--right' : 'media--left')\r\n        toggleSide = !toggleSide\r\n      }\r\n    },\r\n    listenClickByImg() {\r\n      let images = document.getElementsByClassName('picture')\r\n      for (let image of images) {\r\n        image.addEventListener(\"click\", this.openImage);\r\n      }\r\n    },\r\n    openImage(img) {\r\n      this.activeImage = img.target.src\r\n    },\r\n    showSlide(type) {\r\n      let index = 0\r\n      if (type === 'prev') {\r\n        index = this.activeImageIndex > 1 ? this.activeImageIndex - 1 : this.book.files.length - 1\r\n      } else if (type === 'next') {\r\n        index = this.activeImageIndex < this.book.files.length - 1 ? this.activeImageIndex + 1 : 0\r\n      } else if (type === 'last') {\r\n        index = this.book.files.length - 1\r\n      } else if (type === 'first') {\r\n        index = 0\r\n      }\r\n      this.activeImageIndex = index\r\n      this.activeImage = this.getSrcImgUrl(this.book.files[index])\r\n    },\r\n    getSrcImgUrl(e) {\r\n      return e.url ? `${apiUrl}/${e.url}` : ''\r\n    },\r\n    async updateScrollProgress() {\r\n      const url = `/book/update-book?id=${this.book.id}`;\r\n      const formData = {bookmark: this.windowScroll}\r\n      const result = await this.$patch(url, formData)\r\n      if (result) {\r\n        console.log({'result': result})\r\n      } else {\r\n        console.log({'result': result})\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    windowHeights() {\r\n      return document.getElementById('book').scrollHeight - document.getElementById('book').clientHeight\r\n    },\r\n  },\r\n  watch: {},\r\n  created() {\r\n    this.loadBook()\r\n  },\r\n  mounted() {\r\n\r\n  },\r\n  beforeUnmount() {\r\n    this.updateScrollProgress()\r\n  },\r\n  updated() {\r\n    this.moveMedia()\r\n    this.listenClickByImg()\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.book-container {\r\n  height: calc(100vh - 6rem);\r\n  background-color: var(--surface1);\r\n}\r\n\r\n.book {\r\n  display: flex;\r\n  flex-flow: row wrap;\r\n  width: 100%;\r\n  overflow-y: auto;\r\n  height: 100%;\r\n  padding: 1rem;\r\n  justify-content: center;\r\n\r\n  p {\r\n    word-break: break-word;\r\n    padding: initial;\r\n    text-indent: 1rem;\r\n    margin: 0 0 0.3rem;\r\n    position: relative;\r\n    span[data-tooltip]:hover {\r\n      color: crimson;\r\n    }\r\n  }\r\n\r\n  .text {\r\n    max-width: 700px;\r\n    position: relative;\r\n\r\n    .media {\r\n      border: none;\r\n      //display: none;\r\n      cursor: pointer;\r\n      width: 480px;\r\n      height: 320px;\r\n    }\r\n\r\n    .media--right {\r\n      position: absolute;\r\n      right: -500px;\r\n    }\r\n\r\n    .media--left {\r\n      position: absolute;\r\n      left: -500px;\r\n    }\r\n\r\n    h1, h2, h3 {\r\n      text-align: center;\r\n      margin-bottom: 0.5rem;\r\n    }\r\n  }\r\n\r\n  .picture {\r\n    width: inherit;\r\n    height: inherit;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .illustrations {\r\n    display: flex;\r\n    flex: 1;\r\n\r\n  }\r\n\r\n}\r\n\r\n.footer {\r\n  width: 100%;\r\n  height: 2rem;\r\n  display: flex;\r\n  padding: 0.2rem 0.5rem;\r\n  position: relative;\r\n\r\n  .progress {\r\n    width: 100%;\r\n    height: calc(100% - 5px);\r\n    background: var(--bg-secondary);\r\n    position: absolute;\r\n    left: 0;\r\n  }\r\n\r\n  .progress-value {\r\n    position: absolute;\r\n    left: 50%;\r\n    bottom: 5px;\r\n    color: var(--color);\r\n  }\r\n\r\n  .progress::-webkit-progress-value {\r\n  }\r\n}\r\n.image-modal {\r\n  //display: none; /* Hidden by default */\r\n  position: fixed; /* Stay in place */\r\n  z-index: 1; /* Sit on top */\r\n  padding-top: 100px; /* Location of the box */\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%; /* Full width */\r\n  height: 100%; /* Full height */\r\n  overflow: auto; /* Enable scroll if needed */\r\n  background-color: rgb(0, 0, 0); /* Fallback color */\r\n  background-color: rgba(0, 0, 0, 0.9); /* Black w/ opacity */\r\n  .modal-content {\r\n    margin: auto;\r\n    display: block;\r\n    width: 80%;\r\n    max-width: 700px;\r\n  }\r\n\r\n  /* Caption of Modal Image (Image Text) - Same Width as the Image */\r\n  #caption {\r\n    margin: auto;\r\n    display: block;\r\n    width: 80%;\r\n    max-width: 700px;\r\n    text-align: center;\r\n    color: #ccc;\r\n    padding: 10px 0;\r\n    height: 150px;\r\n  }\r\n\r\n  /* Add Animation - Zoom in the Modal */\r\n  .modal-content, #caption {\r\n    animation-name: zoom;\r\n    animation-duration: 0.6s;\r\n  }\r\n}\r\n@keyframes zoom {\r\n  from {\r\n    transform: scale(0)\r\n  }\r\n  to {\r\n    transform: scale(1)\r\n  }\r\n}\r\n\r\n/* The Close Button */\r\n.close {\r\n  position: absolute;\r\n  top: 15px;\r\n  right: 35px;\r\n  color: #f1f1f1;\r\n  font-size: 40px;\r\n  font-weight: bold;\r\n  transition: 0.3s;\r\n}\r\n\r\n.close:hover,\r\n.close:focus {\r\n  color: #bbb;\r\n  text-decoration: none;\r\n  cursor: pointer;\r\n}\r\n\r\n@media only screen and (max-width: 892px) {\r\n  .book-container {\r\n    .book {\r\n      .text {\r\n        max-width: initial;\r\n        width: 100%;\r\n\r\n        .media {\r\n          position: static;\r\n          width: 100%;\r\n          max-height: calc(var(--media-width) / 1.5);\r\n        }\r\n      }\r\n    }\r\n\r\n    .image-modal {\r\n      padding: 0.3rem;\r\n      height: 100%;\r\n      display: flex;\r\n      flex-flow: row nowrap;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n\r\n      .close {\r\n        top: 0;\r\n      }\r\n\r\n      .picture-action-panel {\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n      }\r\n\r\n      .picture-arrow-btn {\r\n        height: 5rem;\r\n        width: 5rem;\r\n        color: var(--color-2);\r\n        background-color: var(--background-3);\r\n      }\r\n\r\n      .modal-content {\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n@media only screen and (min-width: 360px) and (max-width: 892px) and (orientation: landscape) {\r\n\r\n}\r\n\r\n@media only screen and (min-width: 360px) and (max-width: 892px) and (orientation: portrait) {\r\n\r\n}\r\n</style>","import { render } from \"./TheView.vue?vue&type=template&id=41461e94\"\nimport script from \"./TheView.vue?vue&type=script&lang=js\"\nexport * from \"./TheView.vue?vue&type=script&lang=js\"\n\nimport \"./TheView.vue?vue&type=style&index=0&id=41461e94&lang=scss\"\nscript.render = render\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./TheView.vue?vue&type=style&index=0&id=41461e94&lang=scss\""],"sourceRoot":""}