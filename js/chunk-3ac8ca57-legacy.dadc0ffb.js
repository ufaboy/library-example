(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ac8ca57"],{"25f0":function(e,t,o){"use strict";var r=o("6eeb"),n=o("825a"),c=o("d039"),a=o("ad6d"),i="toString",s=RegExp.prototype,l=s[i],u=c((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),d=l.name!=i;(u||d)&&r(RegExp.prototype,i,(function(){var e=n(this),t=String(e.source),o=e.flags,r=String(void 0===o&&e instanceof RegExp&&!("flags"in s)?a.call(e):o);return"/"+t+"/"+r}),{unsafe:!0})},"2dfe":function(e,t,o){"use strict";o.r(t);var r=o("7a23"),n={key:0,class:"footer"},c={class:"progress-value"},a={key:1,id:"image-modal",class:"image-modal"},i={class:"picture-action-panel"},s={class:"picture-action-panel"};function l(e,t,o,l,u,d){var f=Object(r["resolveComponent"])("editor-modal"),g=Object(r["resolveComponent"])("modal");return Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,[Object(r["createVNode"])("div",Object(r["mergeProps"])({class:"book-container"},e.$attrs),[Object(r["createVNode"])("div",{class:"book",ref:"book",onScrollPassive:t[2]||(t[2]=function(){return d.handleScroll&&d.handleScroll.apply(d,arguments)}),id:"book"},[Object(r["createVNode"])("div",{class:"text",ref:"text",innerHTML:e.book.text,onMouseup:t[1]||(t[1]=Object(r["withModifiers"])((function(){return d.editMode&&d.editMode.apply(d,arguments)}),["ctrl"]))},null,40,["innerHTML"])],544)],16),"media"!==e.book.annotation?(Object(r["openBlock"])(),Object(r["createBlock"])("footer",n,[Object(r["createVNode"])("progress",{class:"progress",value:e.progress,max:"100",id:"progressbar",onClick:t[3]||(t[3]=function(){return d.scrollByClick&&d.scrollByClick.apply(d,arguments)})},null,8,["value"]),Object(r["createVNode"])("div",c,Object(r["toDisplayString"])(e.progress),1)])):Object(r["createCommentVNode"])("",!0),Object(r["createVNode"])(g,{ref:"editor"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(f,{"editor-node":e.editorNode,onSaveEditor:d.saveEditor},null,8,["editor-node","onSaveEditor"])]})),_:1},512),e.activeImage?(Object(r["openBlock"])(),Object(r["createBlock"])("div",a,[Object(r["createVNode"])("span",{class:"close",onClick:t[4]||(t[4]=function(t){return e.activeImage=null})},"×"),Object(r["createVNode"])("aside",i,[Object(r["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[5]||(t[5]=function(e){return d.showSlide("first")})},"1"),Object(r["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[6]||(t[6]=function(e){return d.showSlide("prev")})},"Back")]),Object(r["createVNode"])("img",{class:"modal-content",id:"img01",src:e.activeImage},null,8,["src"]),Object(r["createVNode"])("aside",s,[Object(r["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[7]||(t[7]=function(e){return d.showSlide("last")})},"e"),Object(r["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[8]||(t[8]=function(e){return d.showSlide("next")})},"Forward")])])):Object(r["createCommentVNode"])("",!0)],64)}var u=o("b85c"),d=o("1da1"),f=(o("96cf"),o("d3b7"),o("3ca3"),o("ddb0"),o("b0c0"),o("4d63"),o("ac1f"),o("25f0"),o("5319"),o("99af"),"https://google.com"),g={name:"Book",components:{EditorModal:Object(r["defineAsyncComponent"])((function(){return o.e("chunk-4d0178ba").then(o.bind(null,"77d9"))}))},props:{},data:function(){return{book:{annotation:null,text:null,genres:[],bookmark:null},progress:0,progressLoad:0,windowScroll:0,timer:null,activeImage:null,activeImageIndex:0,activeMedia:{type:null,url:null},editorNode:{},initialText:""}},methods:{loadBook:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o="/book/view?id=".concat(e.$route.params.id),t.next=3,e.$get(o);case 3:if(r=t.sent,!r){t.next=12;break}return t.next=7,e.prepareUrlForMedia(r);case 7:e.book=t.sent,document.title="Book: ".concat(r.name),e.scrollToBookmark(),t.next=13;break;case 12:console.log({result:r});case 13:case"end":return t.stop()}}),t)})))()},scrollToBookmark:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.book.bookmark){t.next=4;break}return t.next=3,e.$nextTick();case 3:e.$refs.book.scrollTo(0,e.book.bookmark);case 4:case"end":return t.stop()}}),t)})))()},relocateToMedia:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$emit("loaded-book",e);case 2:return o.next=4,t.$router.push({name:"book-media",params:{id:e.id}});case 4:case"end":return o.stop()}}),o)})))()},scrollByClick:function(e){var t=document.getElementById("progressbar").clientWidth,o=e.offsetX,r=100*o/t;document.getElementById("progressbar").value=r;var n=this.windowHeights*r/100;document.getElementById("book").scrollTo(0,n)},editMode:function(e){this.editorNode=e.target,this.$modal.show("editor",this)},saveEditor:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.book.text=e.$refs.text.innerHTML,o="/book/update?id=".concat(e.$route.params.id),t.next=4,e.$patch(o,{text:e.book.text});case 4:r=t.sent,r?e.$toast.success("Успешно сохранено"):console.log({editor:r});case 6:case"end":return t.stop()}}),t)})))()},handleScroll:function(e){this.progress=Math.round(100*e.target.scrollTop/(e.target.scrollHeight-e.target.clientHeight)),this.windowScroll=e.target.scrollTop},prepareUrlForMedia:function(e){if(e.text){var t=new RegExp("APIURL","g");return e.text=e.text.replace(t,"https://google.com"),e}return e},moveMedia:function(){var e,t=!0,o=document.querySelectorAll(".media"),r=Object(u["a"])(o);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.classList.add(t?"media--right":"media--left"),t=!t}}catch(c){r.e(c)}finally{r.f()}},listenClickByImg:function(){var e,t=document.getElementsByClassName("picture"),o=Object(u["a"])(t);try{for(o.s();!(e=o.n()).done;){var r=e.value;r.addEventListener("click",this.openImage)}}catch(n){o.e(n)}finally{o.f()}},openImage:function(e){this.activeImage=e.target.src},showSlide:function(e){var t=0;"prev"===e?t=this.activeImageIndex>1?this.activeImageIndex-1:this.book.files.length-1:"next"===e?t=this.activeImageIndex<this.book.files.length-1?this.activeImageIndex+1:0:"last"===e?t=this.book.files.length-1:"first"===e&&(t=0),this.activeImageIndex=t,this.activeImage=this.getSrcImgUrl(this.book.files[t])},getSrcImgUrl:function(e){return e.url?"".concat(f,"/").concat(e.url):""},updateScrollProgress:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var o,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o="/book/update-book?id=".concat(e.book.id),r={bookmark:e.windowScroll},t.next=4,e.$patch(o,r);case 4:n=t.sent,console.log({result:n});case 6:case"end":return t.stop()}}),t)})))()}},computed:{windowHeights:function(){return document.getElementById("book").scrollHeight-document.getElementById("book").clientHeight}},watch:{},created:function(){this.loadBook()},mounted:function(){},beforeUnmount:function(){this.updateScrollProgress()},updated:function(){this.moveMedia(),this.listenClickByImg()}};o("e56c");g.render=l;t["default"]=g},4699:function(e,t,o){},"4d63":function(e,t,o){var r=o("83ab"),n=o("da84"),c=o("94ca"),a=o("7156"),i=o("9bf2").f,s=o("241c").f,l=o("44e7"),u=o("ad6d"),d=o("9f7f"),f=o("6eeb"),g=o("d039"),p=o("69f3").enforce,b=o("2626"),m=o("b622"),h=m("match"),k=n.RegExp,v=k.prototype,w=/a/g,x=/a/g,O=new k(w)!==w,j=d.UNSUPPORTED_Y,y=r&&c("RegExp",!O||j||g((function(){return x[h]=!1,k(w)!=w||k(x)==x||"/a/i"!=k(w,"i")})));if(y){var I=function(e,t){var o,r=this instanceof I,n=l(e),c=void 0===t;if(!r&&n&&e.constructor===I&&c)return e;O?n&&!c&&(e=e.source):e instanceof I&&(c&&(t=u.call(e)),e=e.source),j&&(o=!!t&&t.indexOf("y")>-1,o&&(t=t.replace(/y/g,"")));var i=a(O?new k(e,t):k(e,t),r?this:v,I);if(j&&o){var s=p(i);s.sticky=!0}return i},B=function(e){e in I||i(I,e,{configurable:!0,get:function(){return k[e]},set:function(t){k[e]=t}})},S=s(k),N=0;while(S.length>N)B(S[N++]);v.constructor=I,I.prototype=v,f(n,"RegExp",I)}b("RegExp")},e56c:function(e,t,o){"use strict";o("4699")}}]);
//# sourceMappingURL=chunk-3ac8ca57-legacy.dadc0ffb.js.map