(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02a0e3db"],{"2dfe":function(e,t,o){"use strict";o.r(t);var i=o("7a23");const a={key:0,class:"footer"},r={class:"progress-value"},s={key:1,id:"image-modal",class:"image-modal"},c={class:"picture-action-panel"},l={class:"picture-action-panel"};function n(e,t,o,n,d,b){const m=Object(i["resolveComponent"])("editor-modal"),h=Object(i["resolveComponent"])("modal");return Object(i["openBlock"])(),Object(i["createBlock"])(i["Fragment"],null,[Object(i["createVNode"])("div",Object(i["mergeProps"])({class:"book-container"},e.$attrs),[Object(i["createVNode"])("div",{class:"book",ref:"book",onScrollPassive:t[2]||(t[2]=(...e)=>b.handleScroll&&b.handleScroll(...e)),id:"book"},[Object(i["createVNode"])("div",{class:"text",ref:"text",innerHTML:e.book.text,onMouseup:t[1]||(t[1]=Object(i["withModifiers"])((...e)=>b.editMode&&b.editMode(...e),["ctrl"]))},null,40,["innerHTML"])],544)],16),"media"!==e.book.annotation?(Object(i["openBlock"])(),Object(i["createBlock"])("footer",a,[Object(i["createVNode"])("progress",{class:"progress",value:e.progress,max:"100",id:"progressbar",onClick:t[3]||(t[3]=(...e)=>b.scrollByClick&&b.scrollByClick(...e))},null,8,["value"]),Object(i["createVNode"])("div",r,Object(i["toDisplayString"])(e.progress),1)])):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(h,{ref:"editor"},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(m,{"editor-node":e.editorNode,onSaveEditor:b.saveEditor},null,8,["editor-node","onSaveEditor"])]),_:1},512),e.activeImage?(Object(i["openBlock"])(),Object(i["createBlock"])("div",s,[Object(i["createVNode"])("span",{class:"close",onClick:t[4]||(t[4]=t=>e.activeImage=null)},"×"),Object(i["createVNode"])("aside",c,[Object(i["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[5]||(t[5]=e=>b.showSlide("first"))},"1"),Object(i["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[6]||(t[6]=e=>b.showSlide("prev"))},"Back")]),Object(i["createVNode"])("img",{class:"modal-content",id:"img01",src:e.activeImage},null,8,["src"]),Object(i["createVNode"])("aside",l,[Object(i["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[7]||(t[7]=e=>b.showSlide("last"))},"e"),Object(i["createVNode"])("button",{class:"picture-arrow-btn",onClick:t[8]||(t[8]=e=>b.showSlide("next"))},"Forward")])])):Object(i["createCommentVNode"])("",!0)],64)}const d="https://api.librarydev.xyz";var b={name:"Book",components:{EditorModal:Object(i["defineAsyncComponent"])(()=>o.e("chunk-4d0178ba").then(o.bind(null,"77d9")))},props:{},data:()=>({book:{annotation:null,text:null,genres:[],bookmark:null},progress:0,progressLoad:0,windowScroll:0,timer:null,activeImage:null,activeImageIndex:0,activeMedia:{type:null,url:null},editorNode:{},initialText:""}),methods:{async loadBook(){const e="/book/view?id="+this.$route.params.id,t=await this.$get(e);t?(this.book=await this.prepareUrlForMedia(t),document.title="Book: "+t.name,this.scrollToBookmark()):console.log({result:t})},async scrollToBookmark(){this.book.bookmark&&(await this.$nextTick(),this.$refs.book.scrollTo(0,this.book.bookmark))},async relocateToMedia(e){await this.$emit("loaded-book",e),await this.$router.push({name:"book-media",params:{id:e.id}})},scrollByClick(e){let t=document.getElementById("progressbar").clientWidth,o=e.offsetX,i=100*o/t;document.getElementById("progressbar").value=i;let a=this.windowHeights*i/100;document.getElementById("book").scrollTo(0,a)},editMode(e){this.editorNode=e.target,this.$modal.show("editor",this)},async saveEditor(){this.book.text=this.$refs.text.innerHTML;const e="/book/update?id="+this.$route.params.id,t=await this.$patch(e,{text:this.book.text});t?this.$toast.success("Успешно сохранено"):console.log({editor:t})},handleScroll(e){this.progress=Math.round(100*e.target.scrollTop/(e.target.scrollHeight-e.target.clientHeight)),this.windowScroll=e.target.scrollTop},prepareUrlForMedia(e){if(e.text){const t=new RegExp("APIURL","g");return e.text=e.text.replace(t,"https://api.librarydev.xyz"),e}return e},moveMedia(){let e=!0,t=document.querySelectorAll(".media");for(const o of t)o.classList.add(e?"media--right":"media--left"),e=!e},listenClickByImg(){let e=document.getElementsByClassName("picture");for(let t of e)t.addEventListener("click",this.openImage)},openImage(e){this.activeImage=e.target.src},showSlide(e){let t=0;"prev"===e?t=this.activeImageIndex>1?this.activeImageIndex-1:this.book.files.length-1:"next"===e?t=this.activeImageIndex<this.book.files.length-1?this.activeImageIndex+1:0:"last"===e?t=this.book.files.length-1:"first"===e&&(t=0),this.activeImageIndex=t,this.activeImage=this.getSrcImgUrl(this.book.files[t])},getSrcImgUrl(e){return e.url?`${d}/${e.url}`:""},async updateScrollProgress(){const e="/book/update-book?id="+this.book.id,t={bookmark:this.windowScroll},o=await this.$patch(e,t);console.log({result:o})}},computed:{windowHeights(){return document.getElementById("book").scrollHeight-document.getElementById("book").clientHeight}},watch:{},created(){this.loadBook()},mounted(){},beforeUnmount(){this.updateScrollProgress()},updated(){this.moveMedia(),this.listenClickByImg()}};o("e56c");b.render=n;t["default"]=b},4699:function(e,t,o){},e56c:function(e,t,o){"use strict";o("4699")}}]);
//# sourceMappingURL=chunk-02a0e3db.e46caef3.js.map